<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MC合成小游戏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@0.544.0/dist/umd/lucide.min.js"></script>
    <style>
        body {
            background-color: #8B8B8B;
            font-family: 'Minecraft', sans-serif;
        }
        .crafting-grid {
            display: grid;
            grid-template-columns: repeat(3, 64px);
            grid-template-rows: repeat(3, 64px);
            gap: 4px;
        }
        .grid-cell {
            width: 64px;
            height: 64px;
            background-color: #595959;
            border: 2px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .grid-cell:hover {
            background-color: #696969;
        }
        .result-slot {
            width: 64px;
            height: 64px;
            background-color: #595959;
            border: 2px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .item {
            width: 56px;
            height: 56px;
            image-rendering: pixelated;
            cursor: grab;
        }
        .item-count {
            position: absolute;
            bottom: 2px;
            right: 2px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 1px 4px;
            border-radius: 2px;
            font-size: 12px;
        }
        .item-wrapper {
            position: relative;
            width: 56px;
            height: 56px;
        }
        .inventory {
            display: grid;
            grid-template-columns: repeat(9, 64px);
            gap: 4px;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">
    <div class="text-4xl font-bold mb-8 text-white">MC合成小游戏</div>
    <div class="flex items-center gap-8">
        <div class="crafting-grid" id="crafting-grid">
            <!-- 3x3合成网格 -->
        </div>
        <div class="flex items-center">
            <i data-lucide="arrow-right" class="w-12 h-12 text-white"></i>
        </div>
        <div class="result-slot" id="result-slot">
            <!-- 结果槽 -->
        </div>
    </div>
    <div class="mt-8">
        <div class="text-2xl font-bold mb-4 text-white">物品栏</div>
        <div class="inventory" id="inventory">
            <!-- 物品栏 -->
        </div>
    </div>

    <script>
        const items = [
            { name: 'iron_block', image: 'https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/d1483a8f385545d29b561cd374867771.png~tplv-a9rns2rl98-24:720:720.png?rcl=20251227195950049ECA1E3A148F1DDF35&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1767441591&x-signature=B2b9NI%2Fq9nTzf4GW%2F9e4MJsqQI4%3D', count: 9 },
            { name: 'iron_ingot', image: 'https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/a74f2b932e904b6fb188496bb47de7e2.png~tplv-a9rns2rl98-24:720:720.png?rcl=20251227195950049ECA1E3A148F1DDF35&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1767441591&x-signature=SPkyy0HvJHZ%2BmTrDpYeAXePFbbo%3D', count: 9 },
            { name: 'iron_nugget', image: 'https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/9523140e760641868697342784edbe4b.png~tplv-a9rns2rl98-24:720:720.png?rcl=20251227195950049ECA1E3A148F1DDF35&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1767441591&x-signature=DmCqdcw6aSwcpyMe6idabH49w30%3D', count: 9 },
        ];

        const recipes = {
            'iron_block': {
                pattern: [
                    ['iron_ingot', 'iron_ingot', 'iron_ingot'],
                    ['iron_ingot', 'iron_ingot', 'iron_ingot'],
                    ['iron_ingot', 'iron_ingot', 'iron_ingot']
                ],
                result: 'iron_block'
            },
            'iron_ingot': {
                pattern: [
                    ['iron_nugget', 'iron_nugget', 'iron_nugget'],
                    ['iron_nugget', 'iron_nugget', 'iron_nugget'],
                    ['iron_nugget', 'iron_nugget', 'iron_nugget']
                ],
                result: 'iron_ingot'
            }
        };

        const craftingGrid = document.getElementById('crafting-grid');
        const resultSlot = document.getElementById('result-slot');
        const inventory = document.getElementById('inventory');

        const inventorySlots = Array(9).fill(null).map(() => ({ item: null, count: 0 }));

        function initCraftingGrid() {
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.classList.add('grid-cell');
                cell.dataset.index = i;
                cell.addEventListener('dragover', handleDragOver);
                cell.addEventListener('drop', handleDrop);
                craftingGrid.appendChild(cell);
            }
        }

        function initInventory() {
            inventory.innerHTML = '';
            for (let i = 0; i < 9; i++) {
                const slot = document.createElement('div');
                slot.classList.add('grid-cell');
                slot.dataset.index = i;
                
                if (i < items.length) {
                    const item = items[i];
                    inventorySlots[i] = { item: item.name, count: item.count };
                    updateInventorySlot(slot, item.name, item.count);
                }

                slot.addEventListener('click', function() {
                    const slotIndex = parseInt(this.dataset.index);
                    const slotData = inventorySlots[slotIndex];
                    if (slotData.item) {
                        const emptyCell = Array.from(craftingGrid.children).find(cell => cell.querySelector('.item-wrapper') === null);
                        if (emptyCell) {
                            const itemWrapper = document.createElement('div');
                            itemWrapper.classList.add('item-wrapper');
                            itemWrapper.dataset.item = slotData.item;

                            const itemElement = document.createElement('img');
                            itemElement.src = items.find(i => i.name === slotData.item).image;
                            itemElement.alt = slotData.item;
                            itemElement.classList.add('item');

                            const countElement = document.createElement('div');
                            countElement.classList.add('item-count');
                            countElement.textContent = '1';

                            itemWrapper.appendChild(itemElement);
                            itemWrapper.appendChild(countElement);

                            itemWrapper.addEventListener('click', function() {
                                emptyCell.innerHTML = '';
                                checkRecipe();
                            });
                            emptyCell.appendChild(itemWrapper);
                            checkRecipe();

                            slotData.count--;
                            if (slotData.count <= 0) {
                                slotData.item = null;
                                slot.innerHTML = '';
                            } else {
                                updateInventorySlot(slot, slotData.item, slotData.count);
                            }
                        }
                    }
                });
                inventory.appendChild(slot);
            }
        }

        function updateInventorySlot(slot, itemName, count) {
            slot.innerHTML = '';
            if (itemName && count > 0) {
                const item = items.find(i => i.name === itemName);
                const itemWrapper = document.createElement('div');
                itemWrapper.classList.add('item-wrapper');

                const itemElement = document.createElement('img');
                itemElement.src = item.image;
                itemElement.alt = itemName;
                itemElement.classList.add('item');

                const countElement = document.createElement('div');
                countElement.classList.add('item-count');
                countElement.textContent = count;

                itemWrapper.appendChild(itemElement);
                itemWrapper.appendChild(countElement);
                slot.appendChild(itemWrapper);
            }
        }

        function handleDragStart(e) {
            draggedItem = e.target.dataset.item;
            e.dataTransfer.effectAllowed = 'copy';
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'copy';
        }

        function handleDrop(e) {
            e.preventDefault();
            if (draggedItem) {
                const cell = e.target.closest('.grid-cell');
                if (cell) {
                    cell.innerHTML = '';
                    const itemElement = document.createElement('img');
                    itemElement.src = items.find(i => i.name === draggedItem).image;
                    itemElement.alt = draggedItem;
                    itemElement.classList.add('item');
                    itemElement.dataset.item = draggedItem;
                    itemElement.addEventListener('click', function() {
                        cell.innerHTML = '';
                        checkRecipe();
                    });
                    cell.appendChild(itemElement);
                    checkRecipe();
                }
            }
        }
        
        function checkRecipe() {
            const grid = [];
            for (let i = 0; i < 9; i++) {
                const cell = craftingGrid.children[i];
                const itemWrapper = cell.querySelector('.item-wrapper');
                grid.push(itemWrapper ? itemWrapper.dataset.item : null);
            }

            const nonEmptyItems = grid.filter(item => item !== null);

            // 检查分解配方
            if (nonEmptyItems.length === 1) {
                const itemName = nonEmptyItems[0];
                if (itemName === 'iron_block') {
                    const resultItem = items.find(i => i.name === 'iron_ingot');
                    showResult(resultItem.name, 9);
                    return;
                } else if (itemName === 'iron_ingot') {
                    const resultItem = items.find(i => i.name === 'iron_nugget');
                    showResult(resultItem.name, 9);
                    return;
                }
            }

            const grid3x3 = [
                grid.slice(0, 3),
                grid.slice(3, 6),
                grid.slice(6, 9)
            ];

            // 检查合成配方
            for (const [recipeName, recipe] of Object.entries(recipes)) {
                if (comparePatterns(grid3x3, recipe.pattern)) {
                    const resultItem = items.find(i => i.name === recipe.result);
                    showResult(resultItem.name, 1);
                    return;
                }
            }
            
            resultSlot.innerHTML = '';
        }

        function showResult(itemName, count) {
            resultSlot.innerHTML = '';
            const resultItem = items.find(i => i.name === itemName);
            const itemWrapper = document.createElement('div');
            itemWrapper.classList.add('item-wrapper');
            itemWrapper.dataset.item = itemName;
            itemWrapper.dataset.count = count;

            const itemElement = document.createElement('img');
            itemElement.src = resultItem.image;
            itemElement.alt = resultItem.name;
            itemElement.classList.add('item');

            const countElement = document.createElement('div');
            countElement.classList.add('item-count');
            countElement.textContent = count;

            itemWrapper.appendChild(itemElement);
            itemWrapper.appendChild(countElement);
            resultSlot.appendChild(itemWrapper);
        }

        function comparePatterns(grid, pattern) {
            for (let y = 0; y < 3; y++) {
                for (let x = 0; x < 3; x++) {
                    if (pattern[y][x] !== grid[y][x]) {
                        return false;
                    }
                }
            }
            return true;
        }
        
        resultSlot.addEventListener('click', () => {
            const resultWrapper = resultSlot.querySelector('.item-wrapper');
            if (resultWrapper) {
                const resultItemName = resultWrapper.dataset.item;
                const resultCount = parseInt(resultWrapper.dataset.count) || 1;
                addItemsToInventory(resultItemName, resultCount);
                
                resultSlot.innerHTML = '';
                for (let i = 0; i < 9; i++) {
                    craftingGrid.children[i].innerHTML = '';
                }
                checkRecipe();
            }
        });

        function addItemsToInventory(itemName, count) {
            for (let i = 0; i < count; i++) {
                const existingSlot = inventorySlots.findIndex(slot => slot.item === itemName && slot.count < 64);
                if (existingSlot !== -1) {
                    inventorySlots[existingSlot].count++;
                    const slotElement = inventory.children[existingSlot];
                    updateInventorySlot(slotElement, itemName, inventorySlots[existingSlot].count);
                } else {
                    const emptySlot = inventorySlots.findIndex(slot => slot.item === null);
                    if (emptySlot !== -1) {
                        inventorySlots[emptySlot] = { item: itemName, count: 1 };
                        const slotElement = inventory.children[emptySlot];
                        updateInventorySlot(slotElement, itemName, 1);
                    } else {
                        break;
                    }
                }
            }
        }

        initCraftingGrid();
        initInventory();
        lucide.createIcons();
    </script>
</body>
</html>